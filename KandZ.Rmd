---
title: "KandZ_mp2"
author: "Zoya and  Khulood"
date: "3/20/2019"
output: html_document
---

```{r}
install.packages("naniar")
##
```

```{r}
library(tidyverse)
library(naniar)
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


```{r}
first_jim <- candidates %>%
  filter(cand_id == "H8WA07132")
```

```{r}
first_jim <- first_jim %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_office_state) %>%
  inner_join(committees, by = "cand_id")
```



```{r}
committees
```



```{r}
new_table <- inner_join(candidates, contributions, by= "cand_id")
new_table
```


```{r}
MP2_table <- inner_join(new_table, committees, by= "cand_id") %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_state, cmte_name, cmte_state, connected_org_name)
```

```{r}
new_house <- house_elections %>%
  select(fec_id, state,  incumbent, party) %>%
  rename(cand_id= "fec_id")
new_house 
```



```{r}
new_table <- inner_join(MP2_table, new_house, by= "cand_id") %>%
  group_by(cand_name)
new_table
```


```{r}
contributions <- contributions %>%
  select(cmte_id, name, state, cand_id, transaction_amt)
contributions
```


```{r}
committees %>%
  select(cmte_id, cmte_name, cmte_state, cand_id) 
committees
```


```{r}
candidates <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation, cand_office)
candidates
```


```{r}
joined_dataset <- inner_join(committees, candidates, by= "cand_id")
joined_dataset
```


```{r}
j2_dataset <- inner_join(new_house, joined_dataset, by= "cand_id")
j2_dataset
```


```{r}
j3_dataset <- inner_join(j2_dataset, contributions, by= "cmte_id") 
j3_dataset_total <- j3_dataset %>%
 select(cand_id.x, state.x, incumbent, party, cmte_id, cmte_name, cmte_party_affiliation, cand_party_affiliation, cand_office, state.y, transaction_amt) %>%
  group_by(cand_id.x) %>% 
summarize(total_contributions= sum(transaction_amt))
j3_dataset_total
```


```{r}
j3_dataset_state <- j3_dataset %>%
  select(state.x, cand_id.x, transaction_amt) %>%
  group_by(state.x) %>%
  mutate(state.contribution= sum(transaction_amt))
j3_dataset_state
```


```{r}
j3_dataset_final <- inner_join(j3_dataset_total, j3_dataset_state, by= "cand_id.x") %>%
select(-transaction_amt) %>%
  group_by(cand_id.x) %>%
  mutate(percentage_contrib= (total_contributions/state.contribution)*100) %>%
  summarize(mean(percentage_contrib)) %>%
  rename("cand_id"= cand_id.x) %>%
  rename("percent_contr"= mean(percentage_contrib))
j3_dataset_final
```


```{r}
Final_Dataset <- inner_join(j2_dataset, j3_dataset_final, by= "cand_id") %>%
  select(cand_id, state, incumbent, party, cmte_id, cand_office, mean(percentage_contrib))
Final_Dataset
```








